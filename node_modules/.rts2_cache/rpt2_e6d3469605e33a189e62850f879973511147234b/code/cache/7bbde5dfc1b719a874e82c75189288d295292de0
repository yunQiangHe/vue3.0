{"code":"import { effect, activeReactiveEffectStack } from './effect';\r\nimport { refSymbol } from './ref';\r\nimport { isFunction } from '@vue/shared';\r\nexport function computed(getterOrOptions) {\r\n    const isReadonly = isFunction(getterOrOptions);\r\n    const getter = isReadonly\r\n        ? getterOrOptions\r\n        : getterOrOptions.get;\r\n    const setter = isReadonly\r\n        ? () => {\r\n            // TODO warn attempting to mutate readonly computed value\r\n        }\r\n        : getterOrOptions.set;\r\n    let dirty = true;\r\n    let value;\r\n    const runner = effect(getter, {\r\n        lazy: true,\r\n        // mark effect as computed so that it gets priority during trigger\r\n        computed: true,\r\n        scheduler: () => {\r\n            dirty = true;\r\n        }\r\n    });\r\n    return {\r\n        [refSymbol]: true,\r\n        // expose effect so computed can be stopped\r\n        effect: runner,\r\n        get value() {\r\n            if (dirty) {\r\n                value = runner();\r\n                dirty = false;\r\n            }\r\n            // When computed effects are accessed in a parent effect, the parent\r\n            // should track all the dependencies the computed property has tracked.\r\n            // This should also apply for chained computed properties.\r\n            trackChildRun(runner);\r\n            return value;\r\n        },\r\n        set value(newValue) {\r\n            setter(newValue);\r\n        }\r\n    };\r\n}\r\nfunction trackChildRun(childRunner) {\r\n    const parentRunner = activeReactiveEffectStack[activeReactiveEffectStack.length - 1];\r\n    if (parentRunner) {\r\n        for (let i = 0; i < childRunner.deps.length; i++) {\r\n            const dep = childRunner.deps[i];\r\n            if (!dep.has(parentRunner)) {\r\n                dep.add(parentRunner);\r\n                parentRunner.deps.push(dep);\r\n            }\r\n        }\r\n    }\r\n}\r\n","references":["/Users/apple/Desktop/vue3/vue-next/packages/reactivity/src/effect.ts","/Users/apple/Desktop/vue3/vue-next/packages/reactivity/src/ref.ts","/Users/apple/Desktop/vue3/vue-next/packages/shared/src/index.ts"]}
